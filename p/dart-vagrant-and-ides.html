<!DOCTYPE html>
<html class="h-full">
  <head>
    <title>
      Dart, Vagrant and IDEs; Sgoettschkes.me;
    </title>

    <meta charset="utf-8" />
    <meta name="robots" content="index, follow" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />

    <link rel="stylesheet" type="text/css" media="screen" href="//fonts.googleapis.com/css?family=Open+Sans:400,700|Lora:400,700" >
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" media=all href="/css/app.css" />


    <meta name="google-site-verification" content="owr8_sYsogeEj0Ovgy63UTqcNdYayhgQOD611Kcn250" />
  </head>
  <body class="flex flex-col h-full text-black bg-white">
    <header class="flex flex-row h-2/6 min-h-[33%] max-h-[33%] bg-gradient-to-b from-slate-600 to-slate-800">
  <div class="grid items-center w-full grid-cols-1 justify-items-center">
    <div class="text-center text-white h-fit">
      <p class="mb-4 font-serif text-4xl font-bold"><a href="/">Sgoettschkes.me</a></p>
      <p class="font-serif text-xl">Coding 5 to 9</p>
    </div>
  </div>
</header>

    <nav class="pt-4 font-sans text-lg">
  <ul class="mx-auto w-fit">
    <li class="inline pr-12"><a href="/">Home</a></li>
    <li class="inline pr-12"><a href="/about">About</a></li>
    <li class="inline pr-0"><a href="/now">Now</a></li>
  </ul>
</nav>

    <main class="w-3/5 mx-auto my-10 mb-auto">
      
<article class="mb-5">
  <p class="m-0 font-sans text-sm text-gray-400">Written by Sebastian on Jan 21, 2016 in Dev</p>
  <h1 class="mt-2 mb-4 font-serif text-4xl font-bold">Dart, Vagrant and IDEs</h1>
  <p>Using <a href="https://www.vagrantup.com">Vagrant</a> in order to have a reproducible development environment is second nature to me. All projects I work on have a <code class="inline">Vagrantfile</code> and it usually works great.</p><h2>Packages and your IDE</h2><p>One of the biggest problems when running your code inside a virtual machine is the IDE, at least for me. The code lives on my host machine and is synced into the vm, so I use an editor or IDE on my host. I might not have the needed dependencies on my host machine, so the IDE struggles to provide code completion (among other features which only work when the IDE can inspect the libraries used).</p><p><a href="https://www.jetbrains.com/pycharm">PyCharm</a> (and many other JetBrains IDEs) has the ability to use a remote interpreter for Python. Pointing it to the Vagrant machine, PyCharm will ssh into the virtual machine and get the interpreter as well as all libraries installed through pip from there. This works rather well, so even though I don’t have flask installed on my host, I have code completion for the flask API and PyCharm tells me if I am missing an argument. If I use Python 3 for my project and it’s installed in the vm, I don’t need it on my host at all (In fact, I don’t need any Python installed, which is nice if you happen to develop on Windows).</p><h2>Dart and the packages symlinks</h2><p>The Dart plugin for the JetBrains IDEs does not have such a feature. It relies on the Dart SDK installed on your host. I wouldn’t mind installing Dart, but there are some problems:</p><ul><li>Different projects might use different versions of the Dart SDK. Keeping different versions of the SDK is tedious.</li><li>pub, the Dart package manager, downloads packages to <code class="inline">~/.pub-cache</code>. All dependencies need to be downloaded twice to be available inside the vm (to execute the code) and on the host (so the IDE can access it). You could sync your local <code class="inline">pub-cache</code> folder into the vm to get around this issue.</li><li>pub creates symlinks in your project to reference packages. In your project root, it creates a <code class="inline">packages</code> folder which contains symlinks to each package. The paths are absolute, so each time you run it inside the vm, it breaks the lookup on the host and vice verse.</li></ul><p>I didn’t find a solution to my first problem, but could solve the other two!</p><h2>.packages to the rescue</h2><p>As far as the <code class="inline">.pub-cache</code> folder is concerned, there is a third solution beside downloading twice and syncing your pub cache: pub looks up the <code class="inline">PUB_CACHE</code> environment variable and if it contains a valid path, it puts the dependencies there. This way, you can store all your dependencies in your project root in a <code class="inline">.pub-cache</code> (or whatever you wanna call it) folder. It’s synced to your host automatically, so no need to install the same libraries twice.</p><p>The symlinks are a bigger problem, but if you are using Dart 1.12 or higher, there is a way around. By using <code class="inline">--no-package-symlinks</code> as an argument to <code class="inline">pub get</code> ( or <code class="inline">pub upgrade</code>), no symlinks are created. Instead, a single <code class="inline">.packages</code> file is used to store all links for the packages needed. Sadly, this links are again absolute. But with a little bit of <a href="https://github.com/agileaddicts/blitzlicht/blob/affac199cdab1154d66eb327696d26eb19d6b6cc/tool/grind.dart#L77-L80">Dart magic</a> (ok, regex magic), you can change those to be relative and work both on the vm and the host.</p><p>If you are using Dart before 1.12, you can of course try to rewrite the symlinks which might work as well!</p><h2>The rough edges</h2><p>Because the <code class="inline">PUB_CACHE</code> environment variable needs to be set correctly, I only run <code class="inline">pub get</code> and <code class="inline">pub upgrade</code> inside the vm where my provisioning takes care of putting everything in place. On my host, the <code class="inline">PUB_CACHE</code> might point to a different project, messing everything up.</p><p>One also needs to remember to run <code class="inline">pub get</code> with the correct argument and running the script to replace the links to be relative. If you are using some task runner (like <a href="https://pub.dartlang.org/packages/grinder">grinder</a>), this is no issue as you have your task and it takes care of doing all the steps needed. If you are still running tasks manually, well, you might want to consider using a task runner.</p><h2>The state of packages managers</h2><p>While this was intended as a practical post about Dart in the vm and IDEs, there is an underlying question: Why is it so complicated? Turns out that package management is complicated. Every package manager I have worked with has some problems. NPM (for Node.js) downloads every dependency once for each library that depends on it. There is no sharing going on, even if two libraries in one project depend on the exact same version.</p><p>pip (for Python) and gem (for ruby) install packages globally and rely on external solutions (or workarounds) to install dependencies locally for every project. composer (for PHP) installs everything locally but only once, making it the best package manager I worked with in the past. If you work on a lot of projects and all depend on the same set of libraries, there is a certain overhead in downloading those libraries for each project though!</p><p>pub seems to take into account all those problems: it installs each version needed of each library globally (if you don’t mess with the <code class="inline">PUB_CACHE</code>), which means you can have different projects use different versions of the same library OR use the same library without storing it twice. Of course, within one project you can only use one version of each library, so “dependency hell” is still possible.</p><h2>The perfect solution?</h2><p>The best solution would of course be if the Dart plugin could use a remote SDK. I doubt this will come anytime soon (I didn’t see anybody ranting about it anyway). The solution outlined above should also work with any IDE capable of using the <code class="inline">.packages</code> file for Dart.</p><p>Having a working solution in place makes working on Dart projects which run inside a Vagrant vm much nicer. You should try it!</p>
</article>

    </main>
    <footer class="pt-2 pb-4 mt-5 text-sm border-t border-slate-500 bg-gradient-to-b from-slate-200 to-slate-300">
  <div class="flex">
    <div class="flex-none px-4">
      <a href="/feed.xml"><i class="fa-solid fa-rss"></i></a>
    </div>
    <div class="flex-grow text-center">
      <p class="text-xs leading-5">
        &copy; 2014 - 2022
        <a href="/about" class="text-blue">Sebastian Göttschkes</a>
        |
        Hosted by
        <a href="https://pages.github.com/" rel="noopener noreferrer" target="_blank" class="text-blue">GitHub Pages</a>
        |
        Powered by
        <a href="https://stillstatic.io" rel="noopener noreferrer" target="_blank" class="text-blue">Still</a>
      </p>
    </div>
    <div class="flex-none px-3">
      <ul class="">
        <li class="inline mx-1">
          <a href="https://www.facebook.com/sgoettschkes" rel="noopener noreferrer" target="_blank"><i class="fa-brands fa-facebook-f"></i></a>
        </li>
        <li class="inline mx-1">
        <a href="https://twitter.com/Sgoettschkes" rel="noopener noreferrer" target="_blank"><i class="fa-brands fa-twitter"></i></a>
        </li>
        <li class="inline mx-1">
          <a href="https://www.linkedin.com/in/sgoettschkes/" rel="noopener noreferrer" target="_blank"><i class="fa-brands fa-linkedin-in"></i></a>
        </li>
      </ul>
    </div>
  </div>
</footer>

  </body>
</html>
